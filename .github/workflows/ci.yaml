name: CI

on:
  pull_request:
    branches:    
      - main
    types: 
      - opened
      - reopened
      - edited
      - synchronize

jobs:
  tests:
    name: Run tests
    uses: ./.github/workflows/tests.yaml

  summarize-pull-request:
    name: Summarize pull request
    uses: ./.github/workflows/summarize-pull-request.yaml

  update-pull-request-description:
    name: Update pull request description
    needs: [summarize-pull-request]
    runs-on: ubuntu-latest
    steps:
      - name: Update pull request description
        uses: riskledger/update-pr-description@v2
        with:
          body: ${{ needs.summarize-pull-request.outputs.summary }}
          token: ${{ secrets.GITHUB_TOKEN }}